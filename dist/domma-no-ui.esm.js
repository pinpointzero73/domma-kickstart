/*!
 * Domma No-UI Bundle v0.8.0b
 * Dynamic Object Manipulation & Modeling API
 * (c) 2025 Darryl Waterhouse & DCBW-IT
 * Built: 2025-12-16T16:27:37.603Z
 * Commit: a362c96
 */
const e={chunk(e,t=1){if(!e||t<1)return[];const r=[];for(let n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r},compact:e=>e?e.filter(Boolean):[],concat:(e,...t)=>e?e.concat(...t):[],difference(e,...t){if(!e)return[];const r=new Set(t.flat());return e.filter(e=>!r.has(e))},differenceBy(e,t,r){if(!e)return[];const n=new Set(t.map(r));return e.filter(e=>!n.has(r(e)))},differenceWith:(e,t,r)=>e?e.filter(e=>!t.some(t=>r(e,t))):[],drop:(e,t=1)=>e?e.slice(t):[],dropRight(e,t=1){if(!e)return[];const r=e.length-t;return r>0?e.slice(0,r):[]},dropRightWhile(e,t){if(!e)return[];let r=e.length;for(;r--&&t(e[r],r,e););return e.slice(0,r+1)},dropWhile(e,t){if(!e)return[];let r=0;for(;r<e.length&&t(e[r],r,e);)r++;return e.slice(r)},eq:(e,t)=>e===t||e!=e&&t!=t,fill:(e,t,r=0,n)=>e?e.fill(t,r,n):[],findIndex(e,t,r=0){if(!e)return-1;for(let n=r;n<e.length;n++)if(t(e[n],n,e))return n;return-1},findLastIndex(e,t,r){if(!e)return-1;for(let n=void 0!==r?r:e.length-1;n>=0;n--)if(t(e[n],n,e))return n;return-1},first:e=>e?e[0]:void 0,head(e){return this.first(e)},flatten:e=>e?e.flat(1):[],flattenDeep:e=>e?e.flat(1/0):[],flattenDepth:(e,t=1)=>e?e.flat(t):[],fromPairs:e=>e?Object.fromEntries(e):{},indexOf:(e,t,r=0)=>e?e.indexOf(t,r):-1,initial:e=>e?e.slice(0,-1):[],intersection(...e){if(!e.length)return[];return e[0].filter(t=>e.every(e=>e.includes(t)))},join:(e,t=",")=>e?e.join(t):"",last:e=>e?e[e.length-1]:void 0,lastIndexOf:(e,t,r)=>e?void 0!==r?e.lastIndexOf(t,r):e.lastIndexOf(t):-1,nth(e,t=0){if(e)return t<0?e[e.length+t]:e[t]},pull(e,...t){if(!e)return[];const r=new Set(t);for(let t=e.length-1;t>=0;t--)r.has(e[t])&&e.splice(t,1);return e},pullAt(e,...t){if(!e)return[];const r=t.flat().sort((e,t)=>t-e),n=[];return r.forEach(t=>{t>=0&&t<e.length&&n.unshift(e.splice(t,1)[0])}),n},reverse:e=>e?e.reverse():[],slice:(e,t=0,r)=>e?void 0!==r?e.slice(t,r):e.slice(t):[],tail:e=>e?e.slice(1):[],take:(e,t=1)=>e?e.slice(0,t):[],takeRight(e,t=1){if(!e)return[];const r=Math.max(0,e.length-t);return e.slice(r)},union:(...e)=>[...new Set(e.flat())],uniq:e=>e?[...new Set(e)]:[],uniqBy(e,t){if(!e)return[];const r=new Set;return e.filter(e=>{const n=t(e);return!r.has(n)&&(r.add(n),!0)})},without(e,...t){if(!e)return[];const r=new Set(t);return e.filter(e=>!r.has(e))},xor(...e){if(!e.length)return[];const t=new Map;return e.flat().forEach(e=>{t.set(e,(t.get(e)||0)+1)}),[...t.entries()].filter(([,e])=>1===e).map(([e])=>e)},zip(...e){if(!e.length)return[];const t=Math.max(...e.map(e=>e.length)),r=[];for(let n=0;n<t;n++)r.push(e.map(e=>e[n]));return r},zipObject(e,t){if(!e)return{};const r={};return e.forEach((e,n)=>{r[e]=t?t[n]:void 0}),r},times(e,t){if((e=Math.floor(e))<1)return[];const r=new Array(e);for(let n=0;n<e;n++)r[n]=t?t(n):n;return r},range(e,t,r){if(void 0===t&&(t=e,e=0),0===(r=void 0===r?e<t?1:-1:r))return[];const n=Math.max(Math.ceil((t-e)/(r||1)),0),s=new Array(n);for(let t=0;t<n;t++)s[t]=e+t*r;return s},uniqueId:(()=>{let e=0;return function(t=""){const r=++e;return t?`${t}${r}`:String(r)}})(),countBy(e,t){const r={};return this.each(e,e=>{const n=t(e);r[n]=(r[n]||0)+1}),r},each:(e,t)=>(Array.isArray(e)?e.forEach((r,n)=>t(r,n,e)):e&&"object"==typeof e&&Object.keys(e).forEach(r=>t(e[r],r,e)),e),forEach(e,t){return this.each(e,t)},eachRight(e,t){if(Array.isArray(e))for(let r=e.length-1;r>=0;r--)t(e[r],r,e);else if(e&&"object"==typeof e){Object.keys(e).reverse().forEach(r=>t(e[r],r,e))}return e},forEachRight(e,t){return this.eachRight(e,t)},every:(e,t)=>Array.isArray(e)?e.every(t):!e||"object"!=typeof e||Object.values(e).every(t),filter:(e,t)=>Array.isArray(e)?e.filter(t):e&&"object"==typeof e?Object.values(e).filter(t):[],find:(e,t)=>Array.isArray(e)?e.find(t):e&&"object"==typeof e?Object.values(e).find(t):void 0,findLast(e,t){if(Array.isArray(e)){for(let r=e.length-1;r>=0;r--)if(t(e[r],r,e))return e[r]}else if(e&&"object"==typeof e){return Object.values(e).reverse().find(t)}},flatMap(e,t){return this.map(e,t).flat(1)},flatMapDeep(e,t){return this.map(e,t).flat(1/0)},groupBy(e,t){const r={};return this.each(e,e=>{const n="function"==typeof t?t(e):e[t];r[n]||(r[n]=[]),r[n].push(e)}),r},includes:(e,t,r=0)=>"string"==typeof e||Array.isArray(e)?e.includes(t,r):!(!e||"object"!=typeof e)&&Object.values(e).includes(t),keyBy(e,t){const r={};return this.each(e,e=>{const n="function"==typeof t?t(e):e[t];r[n]=e}),r},map:(e,t)=>Array.isArray(e)?e.map(t):e&&"object"==typeof e?Object.entries(e).map(([r,n])=>t(n,r,e)):[],orderBy(e,t,r){const n=Array.isArray(e)?[...e]:Object.values(e),s=Array.isArray(t)?t:[t],i=Array.isArray(r)?r:[r||"asc"];return n.sort((e,t)=>{for(let r=0;r<s.length;r++){const n=s[r],a=i[r]||"asc",o="function"==typeof n?n(e):e[n],l="function"==typeof n?n(t):t[n];if(o<l)return"asc"===a?-1:1;if(o>l)return"asc"===a?1:-1}return 0})},partition(e,t){const r=[],n=[];return this.each(e,(s,i)=>{t(s,i,e)?r.push(s):n.push(s)}),[r,n]},reduce(e,t,r){if(Array.isArray(e))return void 0!==r?e.reduce(t,r):e.reduce(t);if(e&&"object"==typeof e){const n=Object.entries(e);let s=r,i=0;void 0===s&&n.length>0&&(s=n[0][1],i=1);for(let r=i;r<n.length;r++){const[i,a]=n[r];s=t(s,a,i,e)}return s}return r},reduceRight(e,t,r){if(Array.isArray(e))return void 0!==r?e.reduceRight(t,r):e.reduceRight(t);if(e&&"object"==typeof e){const n=Object.entries(e).reverse();let s=r,i=0;void 0===s&&n.length>0&&(s=n[0][1],i=1);for(let r=i;r<n.length;r++){const[i,a]=n[r];s=t(s,a,i,e)}return s}return r},reject(e,t){return this.filter(e,(e,r,n)=>!t(e,r,n))},sample(e){const t=Array.isArray(e)?e:Object.values(e||{});return t[Math.floor(Math.random()*t.length)]},sampleSize(e,t=1){return this.shuffle(Array.isArray(e)?[...e]:Object.values(e||{})).slice(0,t)},shuffle(e){const t=Array.isArray(e)?[...e]:Object.values(e||{});for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t},size:e=>null==e?0:"string"==typeof e||Array.isArray(e)?e.length:"object"==typeof e?Object.keys(e).length:0,some:(e,t)=>Array.isArray(e)?e.some(t):!(!e||"object"!=typeof e)&&Object.values(e).some(t),sortBy:(e,t)=>(Array.isArray(e)?[...e]:Object.values(e)).sort((e,r)=>{const n="function"==typeof t?t(e):e[t],s="function"==typeof t?t(r):r[t];return n<s?-1:n>s?1:0}),after(e,t){let r=0;return function(...n){if(++r>=e)return t.apply(this,n)}},ary:(e,t=e.length)=>function(...r){return e.apply(this,r.slice(0,t))},before(e,t){let r,n=0;return function(...s){return++n<e&&(r=t.apply(this,s)),r}},bind:(e,t,...r)=>function(...n){return e.apply(t,[...r,...n])},curry:(e,t=e.length)=>function r(...n){return n.length>=t?e.apply(this,n):function(...e){return r.apply(this,[...n,...e])}},curryRight:(e,t=e.length)=>function r(...n){return n.length>=t?e.apply(this,n):function(...e){return r.apply(this,[...e,...n])}},debounce(e,t=0,r={}){let n,s,i,a,o,l=0;const u=r.leading||!1,c=!1!==r.trailing,h=r.maxWait;function f(t){const r=s,n=i;return s=i=void 0,l=t,a=e.apply(n,r),a}function d(e){const r=e-o;return void 0===o||r>=t||r<0||void 0!==h&&e-l>=h}function p(){const e=Date.now();if(d(e))return y(e);n=setTimeout(p,function(e){const r=e-o,n=e-l,s=t-r;return void 0!==h?Math.min(s,h-n):s}(e))}function y(e){return n=void 0,c&&s?f(e):(s=i=void 0,a)}function g(...e){const r=Date.now(),c=d(r);if(s=e,i=this,o=r,c){if(void 0===n)return function(e){return l=e,n=setTimeout(p,t),u?f(e):a}(o);if(void 0!==h)return n=setTimeout(p,t),f(o)}return void 0===n&&(n=setTimeout(p,t)),a}return g.cancel=function(){void 0!==n&&clearTimeout(n),l=0,s=o=i=n=void 0},g.flush=function(){return void 0===n?a:y(Date.now())},g},defer(e,...t){return setTimeout(()=>e.apply(this,t),1)},delay(e,t,...r){return setTimeout(()=>e.apply(this,r),t)},flip:e=>function(...t){return e.apply(this,t.reverse())},flow(...e){const t=e.length;return 0===t?function(e){return e}:1===t?e[0]:function(...r){let n=e[0].apply(this,r);for(let r=1;r<t;r++)n=e[r].call(this,n);return n}},compose(...e){return this.flow(...e.reverse())},memoize(e,t){const r=new Map,n=function(...n){const s=t?t.apply(this,n):n[0];if(r.has(s))return r.get(s);const i=e.apply(this,n);return r.set(s,i),i};return n.cache=r,n},negate:e=>function(...t){return!e.apply(this,t)},once(e){return this.before(2,e)},partial:(e,...t)=>function(...r){return e.apply(this,[...t,...r])},partialRight:(e,...t)=>function(...r){return e.apply(this,[...r,...t])},throttle(e,t=0,r={}){const n=!1!==r.leading,s=!1!==r.trailing;return this.debounce(e,t,{leading:n,trailing:s,maxWait:t})},unary(e){return this.ary(e,1)},wrap:(e,t)=>function(...r){return t.apply(this,[e,...r])},assign:(e,...t)=>Object.assign(e||{},...t),assignIn(e,...t){const r=e||{};return t.forEach(e=>{if(e)for(const t in e)r[t]=e[t]}),r},extend(e,...t){return this.assignIn(e,...t)},at(e,...t){return t.flat().map(t=>this.get(e,t))},clone:e=>null===e||"object"!=typeof e?e:Array.isArray(e)?[...e]:{...e},cloneDeep(e){if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(e=>this.cloneDeep(e));if(e instanceof Date)return new Date(e);if(e instanceof RegExp)return new RegExp(e);const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=this.cloneDeep(e[r]));return t},defaults(e,...t){const r=e||{};return t.forEach(e=>{e&&Object.keys(e).forEach(t=>{void 0===r[t]&&(r[t]=e[t])})}),r},defaultsDeep(e,...t){const r=e||{};return t.forEach(e=>{e&&"object"==typeof e&&Object.keys(e).forEach(t=>{const n=r[t],s=e[t];void 0===n?r[t]=this.cloneDeep(s):n&&"object"==typeof n&&s&&"object"==typeof s&&!Array.isArray(n)&&!Array.isArray(s)&&this.defaultsDeep(n,s)})}),r},entries:e=>e?Object.entries(e):[],toPairs(e){return this.entries(e)},findKey(e,t){if(e)for(const r of Object.keys(e))if(t(e[r],r,e))return r},findLastKey(e,t){if(!e)return;const r=Object.keys(e).reverse();for(const n of r)if(t(e[n],n,e))return n},forIn(e,t){if(e)for(const r in e)if(!1===t(e[r],r,e))break;return e},forOwn(e,t){if(e)for(const r of Object.keys(e))if(!1===t(e[r],r,e))break;return e},get(e,t,r){if(!e)return r;const n=Array.isArray(t)?t:t.replace(/\[(\d+)]/g,".$1").split(".");let s=e;for(const e of n){if(null==s)return r;s=s[e]}return void 0===s?r:s},has(e,t){if(!e)return!1;const r=Array.isArray(t)?t:t.replace(/\[(\d+)]/g,".$1").split(".");let n=e;for(const e of r){if(!Object.prototype.hasOwnProperty.call(n,e))return!1;n=n[e]}return!0},invert(e){const t={};return e&&Object.entries(e).forEach(([e,r])=>{t[r]=e}),t},invertBy(e,t=e=>e){const r={};return e&&Object.entries(e).forEach(([e,n])=>{const s=t(n);r[s]||(r[s]=[]),r[s].push(e)}),r},keys:e=>e?Object.keys(e):[],keysIn(e){const t=[];for(const r in e)t.push(r);return t},mapKeys(e,t){const r={};return e&&Object.entries(e).forEach(([n,s])=>{r[t(s,n,e)]=s}),r},mapValues(e,t){const r={};return e&&Object.entries(e).forEach(([n,s])=>{r[n]=t(s,n,e)}),r},merge(e,...t){const r=e||{};return t.forEach(e=>{e&&"object"==typeof e&&Object.keys(e).forEach(t=>{const n=r[t],s=e[t];n&&"object"==typeof n&&s&&"object"==typeof s&&!Array.isArray(n)&&!Array.isArray(s)?this.merge(n,s):r[t]=s})}),r},omit(e,...t){if(!e)return{};const r=new Set(t.flat()),n={};return Object.keys(e).forEach(t=>{r.has(t)||(n[t]=e[t])}),n},omitBy(e,t){if(!e)return{};const r={};return Object.entries(e).forEach(([e,n])=>{t(n,e)||(r[e]=n)}),r},pick(e,...t){if(!e)return{};const r=new Set(t.flat()),n={};return r.forEach(t=>{t in e&&(n[t]=e[t])}),n},pickBy(e,t){if(!e)return{};const r={};return Object.entries(e).forEach(([e,n])=>{t(n,e)&&(r[e]=n)}),r},set(e,t,r){if(!e)return e;const n=Array.isArray(t)?t:t.replace(/\[(\d+)]/g,".$1").split(".");let s=e;for(let e=0;e<n.length-1;e++){const t=n[e],r=n[e+1];t in s&&null!==s[t]&&"object"==typeof s[t]||(s[t]=/^\d+$/.test(r)?[]:{}),s=s[t]}return s[n[n.length-1]]=r,e},unset(e,t){if(!e)return!0;const r=Array.isArray(t)?t:t.replace(/\[(\d+)]/g,".$1").split(".");let n=e;for(let e=0;e<r.length-1;e++){const t=r[e];if(!(t in n))return!0;n=n[t]}return delete n[r[r.length-1]]},setIfUndefined(e,t,r){return void 0===this.get(e,t)&&this.set(e,t,r),e},values:e=>e?Object.values(e):[],valuesIn(e){const t=[];for(const r in e)t.push(e[r]);return t},isArray:e=>Array.isArray(e),isBoolean:e=>"boolean"==typeof e||e instanceof Boolean,isDate:e=>e instanceof Date,isEmpty:e=>null==e||(Array.isArray(e)||"string"==typeof e?0===e.length:e instanceof Map||e instanceof Set?0===e.size:"object"!=typeof e||0===Object.keys(e).length),isEqual(e,t){if(e===t)return!0;if(null===e||null===t)return e===t;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((e,r)=>this.isEqual(e,t[r]));if(Array.isArray(e)||Array.isArray(t))return!1;const r=Object.keys(e),n=Object.keys(t);return r.length===n.length&&r.every(r=>this.isEqual(e[r],t[r]))},isMatch(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;const r=Object.keys(t);for(const n of r){const r=e[n],s=t[n];if("object"==typeof s&&null!==s){if(!this.isMatch(r,s))return!1}else if(r!==s)return!1}return!0},isFinite:e=>Number.isFinite(e),isFunction:e=>"function"==typeof e,isInteger:e=>Number.isInteger(e),isNaN:e=>Number.isNaN(e),isNil:e=>null==e,isNull:e=>null===e,isNumber:e=>"number"==typeof e||e instanceof Number,isObject:e=>null!==e&&"object"==typeof e,isPlainObject(e){if(null===e||"object"!=typeof e)return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype},isRegExp:e=>e instanceof RegExp,isString:e=>"string"==typeof e||e instanceof String,isSymbol:e=>"symbol"==typeof e,isUndefined:e=>void 0===e,parseInt:(e,t)=>(void 0===t&&(t=/^0x/i.test(e)?16:10),null==e?NaN:"number"==typeof e?Math.trunc(e):(e=String(e).trim(),parseInt(e,t))),toNumber(e){if("number"==typeof e)return e;if("symbol"==typeof e)return NaN;if(this.isObject(e)){const t="function"==typeof e.valueOf?e.valueOf():e;e=this.isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.trim();const t=/^0b[01]+$/i.test(e),r=/^0o[0-7]+$/i.test(e),n=/^[-+]0x[0-9a-f]+$/i.test(e);return t||r?parseInt(e.slice(2),t?2:8):n?NaN:+e},toInteger(e){const t=this.toNumber(e);return Number.isNaN(t)?0:0!==t&&Number.isFinite(t)?Math.trunc(t):t},toFinite(e){const t=17976931348623157e292;if(!e)return 0===e?e:0;const r=this.toNumber(e);return r===1/0?t:r===-1/0?-t:r==r?r:0},toSafeInteger(e){const t=9007199254740991,r=this.toInteger(e);return r<-9007199254740991?-9007199254740991:r>t?t:r},toString(e){if(null==e)return"";if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>null==e?"":this.toString(e)).join(",");if("symbol"==typeof e)return e.toString();const t=String(e);return"0"===t&&1/e==-1/0?"-0":t},toArray(e){return e?this.isArray(e)?[...e]:"string"==typeof e?e.split(""):this.isObject(e)?"function"==typeof e[Symbol.iterator]?[...e]:Object.values(e):[]:[]},castArray(...e){if(!e.length)return[];const t=e[0];return this.isArray(t)?t:[t]},toLength(e){const t=4294967295,r=this.toInteger(e);return r<0?0:r>t?t:r},toPlainObject(e){const t={};for(const r in e)t[r]=e[r];return t},add:(e,t)=>e+t,ceil(e,t=0){const r=Math.pow(10,t);return Math.ceil(e*r)/r},divide:(e,t)=>e/t,floor(e,t=0){const r=Math.pow(10,t);return Math.floor(e*r)/r},max:e=>e&&e.length?Math.max(...e):void 0,maxBy(e,t){if(e&&e.length)return e.reduce((e,r)=>("function"==typeof t?t(r):r[t])>("function"==typeof t?t(e):e[t])?r:e)},mean(e){return e&&e.length?this.sum(e)/e.length:NaN},meanBy(e,t){return e&&e.length?this.sumBy(e,t)/e.length:NaN},min:e=>e&&e.length?Math.min(...e):void 0,minBy(e,t){if(e&&e.length)return e.reduce((e,r)=>("function"==typeof t?t(r):r[t])<("function"==typeof t?t(e):e[t])?r:e)},multiply:(e,t)=>e*t,round(e,t=0){const r=Math.pow(10,t);return Math.round(e*r)/r},subtract:(e,t)=>e-t,sum:e=>e?e.reduce((e,t)=>e+t,0):0,sumBy:(e,t)=>e?e.reduce((e,r)=>e+("function"==typeof t?t(r):r[t]),0):0,clamp:(e,t,r)=>(void 0===r&&(r=t,t=void 0),void 0!==t&&e<t?t:void 0!==r&&e>r?r:e),inRange:(e,t,r)=>(void 0===r&&(r=t,t=0),t>r&&([t,r]=[r,t]),e>=t&&e<r),random:(e=0,t=1,r)=>("boolean"==typeof e?(r=e,e=0,t=1):"boolean"==typeof t&&(r=t,t=e,e=0),e>t&&([e,t]=[t,e]),r||e%1!=0||t%1!=0?e+Math.random()*(t-e):e+Math.floor(Math.random()*(t-e+1))),camelCase:e=>e?e.replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase()).replace(/^[A-Z]/,e=>e.toLowerCase()):"",capitalize:e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():"",endsWith:(e,t,r)=>!!e&&(void 0!==r?e.slice(0,r).endsWith(t):e.endsWith(t)),escape(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,e=>t[e])},kebabCase:e=>e?e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase():"",lowerCase(e){return e?this.words(e).join(" ").toLowerCase():""},lowerFirst:e=>e?e.charAt(0).toLowerCase()+e.slice(1):"",pad(e="",t=0,r=" "){const n=e.length;if(n>=t)return e;const s=t-n,i=Math.floor(s/2),a=s-i;return r.repeat(Math.ceil(i/r.length)).slice(0,i)+e+r.repeat(Math.ceil(a/r.length)).slice(0,a)},padEnd(e="",t=0,r=" "){const n=e.length;if(n>=t)return e;const s=t-n;return e+r.repeat(Math.ceil(s/r.length)).slice(0,s)},padStart(e="",t=0,r=" "){const n=e.length;if(n>=t)return e;const s=t-n;return r.repeat(Math.ceil(s/r.length)).slice(0,s)+e},repeat:(e="",t=1)=>e.repeat(Math.max(0,Math.floor(t))),replace:(e="",t,r)=>e.replace(t,r),snakeCase(e){return e?this.words(e).join("_").toLowerCase():""},split:(e="",t,r)=>e.split(t,r),startCase(e){return e?this.words(e).map(e=>this.capitalize(e)).join(" "):""},startsWith:(e,t,r=0)=>!!e&&e.startsWith(t,r),toLower:e=>e?e.toLowerCase():"",toUpper:e=>e?e.toUpperCase():"",trim(e="",t){if(!t)return e.trim();const r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return e.replace(new RegExp(`^[${r}]+|[${r}]+$`,"g"),"")},trimEnd(e="",t){if(!t)return e.trimEnd();const r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return e.replace(new RegExp(`[${r}]+$`,"g"),"")},trimStart(e="",t){if(!t)return e.trimStart();const r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return e.replace(new RegExp(`^[${r}]+`,"g"),"")},truncate(e="",t={}){const r=t.length||30,n=t.omission||"...",s=t.separator;if(e.length<=r)return e;let i=r-n.length;if(i<1)return n;let a=e.slice(0,i);if(s){const e="string"==typeof s?a.lastIndexOf(s):a.search(new RegExp(s.source+"(?!.*"+s.source+")"));e>-1&&(a=a.slice(0,e))}return a+n},unescape(e){if(!e)return"";const t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return e.replace(/&(?:amp|lt|gt|quot|#39);/g,e=>t[e])},upperCase(e){return e?this.words(e).join(" ").toUpperCase():""},upperFirst:e=>e?e.charAt(0).toUpperCase()+e.slice(1):"",words:(e="",t)=>t?e.match(t)||[]:(e=e.replace(/([a-z])([A-Z])/g,"$1 $2")).match(/[a-zA-Z0-9]+/g)||[],sprintf(e,...t){if(!e)return"";let r=0;return e.replace(/%(?:(\d+)\$)?([+-])?(\d+)?(?:\.(\d+))?([sdifojx%])/g,(e,n,s,i,a,o)=>{if("%"===o)return"%";const l=n?parseInt(n,10)-1:r++,u=t[l];if(void 0===u)return e;if(null===u)return"null";let c;switch(o){case"s":default:c=String(u);break;case"d":case"i":c=String(parseInt(u,10));break;case"f":const e=parseFloat(u);c=void 0!==a?e.toFixed(parseInt(a,10)):String(e);break;case"o":c=Object.prototype.toString.call(u);break;case"j":try{c=JSON.stringify(u)}catch(e){c="[Circular]"}break;case"x":c=parseInt(u,10).toString(16)}if(i){const e=parseInt(i,10),t="0"===s?"0":" ";c="-"===s?c.padEnd(e," "):c.padStart(e,t)}if("+"===s&&("d"===o||"i"===o||"f"===o)){parseFloat(c)>=0&&!c.startsWith("+")&&(c="+"+c)}return c})},format(e,...t){return this.sprintf(e,...t)},template(e,t={}){const{partials:r={},helpers:n={}}=t,s=e=>null==e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),i=(e,t)=>"."===t?e:t.startsWith("@")?e[t]:t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:"",e),a=(e,t,o=null)=>{let l=e;return l=l.replace(/\{\{#with\s+([^}]+)\}\}([\s\S]*?)\{\{\/with\}\}/g,(e,r,n)=>{const s=i(t,r.trim());return s&&"object"==typeof s?a(n,s,t):""}),l=l.replace(/\{\{#each\s+([^}]+)\}\}([\s\S]*?)\{\{\/each\}\}/g,(e,r,n)=>{const s=i(t,r.trim());return Array.isArray(s)?s.map((e,r)=>{const i="object"==typeof e?{...e,"@index":r,"@first":0===r,"@last":r===s.length-1}:{".":e,"@index":r,"@first":0===r,"@last":r===s.length-1};return a(n,i,t)}).join(""):""}),l=l.replace(/\{\{#if\s+([^}]+)\}\}([\s\S]*?)(?:\{\{else\}\}([\s\S]*?))?\{\{\/if\}\}/g,(e,r,n,s="")=>{const l=i(t,r.trim()),u=Array.isArray(l)?l.length>0:Boolean(l);return a(u?n:s,t,o)}),l=l.replace(/\{\{#unless\s+([^}]+)\}\}([\s\S]*?)\{\{\/unless\}\}/g,(e,r,n)=>{const s=i(t,r.trim());return(Array.isArray(s)?0===s.length:!s)?a(n,t,o):""}),l=l.replace(/\{\{>\s*([^}]+)\}\}/g,(e,n)=>{const s=r[n.trim()];return s?a(s,t,o):""}),l=l.replace(/\{\{\{([^}]+)\}\}\}/g,(e,r)=>{const n=i(t,r.trim());return null!=n?String(n):""}),l=l.replace(/\{\{([^#/>][^}]*)\}\}/g,(e,r)=>{const a=r.trim(),o=a.match(/^(\w+)\s+(.+)$/);if(o&&n[o[1]]){const e=o[2].split(/\s+/).map(e=>/^["'].*["']$/.test(e)?e.slice(1,-1):i(t,e));return s(n[o[1]](...e))}const l=i(t,a);return s(l)}),l};return(t={})=>a(e,t)},render(e,t,r={}){return this.template(e,r)(t)},async copyToClipboard(e){if(navigator.clipboard?.writeText)try{return await navigator.clipboard.writeText(e),!0}catch(e){}const t=document.createElement("textarea");t.value=e,t.style.cssText="position:fixed;opacity:0;pointer-events:none",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(e){return!1}finally{document.body.removeChild(t)}},chain(t){const r={_value:t,value(){return this._value}};["chunk","compact","concat","difference","drop","dropRight","fill","findIndex","findLastIndex","flatten","flattenDeep","flattenDepth","fromPairs","head","indexOf","initial","intersection","join","last","lastIndexOf","nth","pull","pullAll","pullAt","remove","reverse","slice","sortedIndex","sortedUniq","tail","take","takeRight","union","uniq","uniqBy","unzip","without","xor","zip","countBy","each","every","filter","find","findLast","flatMap","groupBy","includes","invokeMap","keyBy","map","orderBy","partition","reduce","reduceRight","reject","sample","sampleSize","shuffle","size","some","sortBy","assign","assignIn","at","defaults","entries","extend","findKey","findLastKey","forIn","forOwn","functions","get","has","invert","invertBy","invoke","keys","mapKeys","mapValues","merge","omit","omitBy","pick","pickBy","result","set","toPairs","transform","unset","update","values","camelCase","capitalize","deburr","endsWith","escape","escapeRegExp","kebabCase","lowerCase","lowerFirst","pad","padEnd","padStart","parseInt","repeat","replace","snakeCase","split","startCase","startsWith","toLower","toUpper","trim","trimEnd","trimStart","truncate","unescape","upperCase","upperFirst","words"].forEach(t=>{"function"==typeof this[t]&&(r[t]=function(...r){return this._value=e[t](this._value,...r),this})});return["sum","mean","min","max","toArray","toJSON","toString"].forEach(t=>{"function"==typeof this[t]&&(r[t]=function(...r){return e[t](this._value,...r)})}),r}},t={async request(e,t,r=null,n={}){const s={method:e,headers:{"Content-Type":"application/json",...n.headers},...n};r&&"GET"!==e&&"HEAD"!==e&&(s.body=JSON.stringify(r));try{const e=await fetch(t,s);if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);return await e.json()}catch(e){throw console.error("Domma HTTP Error:",e),e}},get(e,t){return this.request("GET",e,null,t)},post(e,t,r){return this.request("POST",e,t,r)},put(e,t,r){return this.request("PUT",e,t,r)},delete(e,t){return this.request("DELETE",e,null,t)}},r=1e3,n=6e4,s=36e5,i=864e5,a=6048e5,o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=["January","February","March","April","May","June","July","August","September","October","November","December"],c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];class h{constructor(e){e instanceof h?this._date=new Date(e._date):e instanceof Date?this._date=new Date(e):this._date="string"==typeof e||"number"==typeof e?new Date(e):null==e?new Date:new Date(e)}add(e,t){const r=this._normalizeUnit(t),n=this._date;return"years"===r?n.setFullYear(n.getFullYear()+e):"months"===r?n.setMonth(n.getMonth()+e):"weeks"===r?n.setDate(n.getDate()+7*e):"days"===r?n.setDate(n.getDate()+e):"hours"===r?n.setHours(n.getHours()+e):"minutes"===r?n.setMinutes(n.getMinutes()+e):"seconds"===r?n.setSeconds(n.getSeconds()+e):"milliseconds"===r&&n.setMilliseconds(n.getMilliseconds()+e),this}subtract(e,t){return this.add(-e,t)}startOf(e){const t=this._normalizeUnit(e),r=this._date;return"years"===t||"year"===t?(r.setMonth(0,1),r.setHours(0,0,0,0)):"months"===t||"month"===t?(r.setDate(1),r.setHours(0,0,0,0)):"weeks"===t||"week"===t?(r.setDate(r.getDate()-r.getDay()),r.setHours(0,0,0,0)):"days"===t||"day"===t?r.setHours(0,0,0,0):"hours"===t||"hour"===t?r.setMinutes(0,0,0):"minutes"===t||"minute"===t?r.setSeconds(0,0):"seconds"!==t&&"second"!==t||r.setMilliseconds(0),this}endOf(e){const t=this._normalizeUnit(e),r=this._date;return"years"===t||"year"===t?(r.setMonth(11,31),r.setHours(23,59,59,999)):"months"===t||"month"===t?(r.setMonth(r.getMonth()+1,0),r.setHours(23,59,59,999)):"weeks"===t||"week"===t?(r.setDate(r.getDate()+(6-r.getDay())),r.setHours(23,59,59,999)):"days"===t||"day"===t?r.setHours(23,59,59,999):"hours"===t||"hour"===t?r.setMinutes(59,59,999):"minutes"===t||"minute"===t?r.setSeconds(59,999):"seconds"!==t&&"second"!==t||r.setMilliseconds(999),this}set(e,t){const r=this._normalizeUnit(e),n=this._date;return"years"===r||"year"===r?n.setFullYear(t):"months"===r||"month"===r?n.setMonth(t):"days"===r||"day"===r||"date"===r?n.setDate(t):"hours"===r||"hour"===r?n.setHours(t):"minutes"===r||"minute"===r?n.setMinutes(t):"seconds"===r||"second"===r?n.setSeconds(t):"milliseconds"!==r&&"millisecond"!==r||n.setMilliseconds(t),this}get(e){if(!e)return this._date;const t=this._normalizeUnit(e),r=this._date;return"years"===t||"year"===t?r.getFullYear():"months"===t||"month"===t?r.getMonth():"days"===t||"day"===t?r.getDay():"date"===t?r.getDate():"hours"===t||"hour"===t?r.getHours():"minutes"===t||"minute"===t?r.getMinutes():"seconds"===t||"second"===t?r.getSeconds():"milliseconds"===t||"millisecond"===t?r.getMilliseconds():this._date}year(){return this._date.getFullYear()}month(){return this._date.getMonth()}date(){return this._date.getDate()}day(){return this._date.getDay()}hour(){return this._date.getHours()}minute(){return this._date.getMinutes()}second(){return this._date.getSeconds()}millisecond(){return this._date.getMilliseconds()}dayOfYear(){const e=new Date(this._date.getFullYear(),0,0),t=this._date-e;return Math.floor(t/864e5)}week(){const e=new Date(this._date.getFullYear(),0,1),t=this._date-e;return Math.ceil(t/6048e5+e.getDay()/7)}quarter(){return Math.floor(this._date.getMonth()/3)+1}unix(){return Math.floor(this._date.getTime()/1e3)}valueOf(){return this._date.getTime()}format(e="YYYY-MM-DD HH:mm:ss"){const t=this._date,r=t.getFullYear(),n=t.getMonth(),s=t.getDate(),i=t.getDay(),a=t.getHours(),h=t.getMinutes(),f=t.getSeconds(),d=t.getMilliseconds(),p=a%12||12,y=(e,t=2)=>String(e).padStart(t,"0"),g={YYYY:r,YY:String(r).slice(-2),MMMM:u[n],MMM:c[n],MM:y(n+1),M:n+1,dddd:o[i],ddd:l[i],DD:y(s),D:s,HH:y(a),H:a,hh:y(p),h:p,mm:y(h),m:h,ss:y(f),s:f,SSS:y(d,3),A:a<12?"AM":"PM",a:a<12?"am":"pm"},m=Object.keys(g).sort((e,t)=>t.length-e.length),b=new RegExp(m.join("|"),"g");return e.replace(b,e=>g[e])}toISOString(){return this._date.toISOString()}toDate(){return new Date(this._date)}toString(){return this._date.toString()}fromNow(e){const t=e?new h(e)._date:new Date,r=this._date.getTime()-t.getTime(),o=Math.abs(r),l=r<0;let u,c;return o<n?"just now":(o<s?(u=Math.floor(o/n),c=1===u?"minute":"minutes"):o<i?(u=Math.floor(o/s),c=1===u?"hour":"hours"):o<a?(u=Math.floor(o/i),c=1===u?"day":"days"):o<30*i?(u=Math.floor(o/a),c=1===u?"week":"weeks"):o<365*i?(u=Math.floor(o/(30*i)),c=1===u?"month":"months"):(u=Math.floor(o/(365*i)),c=1===u?"year":"years"),l?`${u} ${c} ago`:`in ${u} ${c}`)}to(e){const t=new h(e)._date.getTime()-this._date.getTime(),r=Math.abs(t),o=t>0;let l,u;return r<n?"just now":(r<s?(l=Math.floor(r/n),u=1===l?"minute":"minutes"):r<i?(l=Math.floor(r/s),u=1===l?"hour":"hours"):r<a?(l=Math.floor(r/i),u=1===l?"day":"days"):r<30*i?(l=Math.floor(r/a),u=1===l?"week":"weeks"):r<365*i?(l=Math.floor(r/(30*i)),u=1===l?"month":"months"):(l=Math.floor(r/(365*i)),u=1===l?"year":"years"),o?`in ${l} ${u}`:`${l} ${u} ago`)}isBefore(e,t){const r=new h(e);return t?this.clone().endOf(t).valueOf()<r.clone().startOf(t).valueOf():this._date.getTime()<r._date.getTime()}isAfter(e,t){const r=new h(e);return t?this.clone().startOf(t).valueOf()>r.clone().endOf(t).valueOf():this._date.getTime()>r._date.getTime()}isSame(e,t){const r=new h(e);if(!t)return this._date.getTime()===r._date.getTime();const n=this.clone().startOf(t).valueOf(),s=this.clone().endOf(t).valueOf(),i=r.valueOf();return i>=n&&i<=s}isBetween(e,t,r,n="()"){const s=new h(e),i=new h(t);let a,o,l;r?(a=s.clone().startOf(r).valueOf(),o=i.clone().endOf(r).valueOf(),l=this.clone().startOf(r).valueOf()):(a=s.valueOf(),o=i.valueOf(),l=this.valueOf());const u="["===n[0],c="]"===n[1];return(u?l>=a:l>a)&&(c?l<=o:l<o)}diff(e,t="milliseconds",o=!1){const l=new h(e),u=this._date.getTime()-l._date.getTime(),c=this._normalizeUnit(t);let f;return f="milliseconds"===c?u:"seconds"===c?u/r:"minutes"===c?u/n:"hours"===c?u/s:"days"===c?u/i:"weeks"===c?u/a:"months"===c?this._monthDiff(l):"years"===c?this._monthDiff(l)/12:u,o?f:Math.floor(f)}_monthDiff(e){const t=this._date,r=e._date;return 12*(t.getFullYear()-r.getFullYear())+(t.getMonth()-r.getMonth())}isValid(){return!isNaN(this._date.getTime())}isLeapYear(){const e=this._date.getFullYear();return e%4==0&&e%100!=0||e%400==0}daysInMonth(){return new Date(this._date.getFullYear(),this._date.getMonth()+1,0).getDate()}clone(){return new h(this._date)}_normalizeUnit(e){if(!e)return e;const t=String(e).toLowerCase().trim();return"year"===t?"years":"month"===t?"months":"week"===t?"weeks":"day"===t?"days":"hour"===t?"hours":"minute"===t?"minutes":"second"===t?"seconds":"millisecond"===t?"milliseconds":t}}const f=function(e){return new h(e)};Object.assign(f,{now:()=>Date.now(),parse(e,t){if(!t)return new h(e);const r={YYYY:{regex:"(\\d{4})",setter:"year"},YY:{regex:"(\\d{2})",setter:"year",transform:e=>2e3+parseInt(e)},MM:{regex:"(\\d{2})",setter:"month",transform:e=>parseInt(e)-1},M:{regex:"(\\d{1,2})",setter:"month",transform:e=>parseInt(e)-1},DD:{regex:"(\\d{2})",setter:"date"},D:{regex:"(\\d{1,2})",setter:"date"},HH:{regex:"(\\d{2})",setter:"hour"},H:{regex:"(\\d{1,2})",setter:"hour"},mm:{regex:"(\\d{2})",setter:"minute"},m:{regex:"(\\d{1,2})",setter:"minute"},ss:{regex:"(\\d{2})",setter:"second"},s:{regex:"(\\d{1,2})",setter:"second"}};let n=t;const s=[],i=Object.keys(r).sort((e,t)=>t.length-e.length);for(const e of i)if(t.includes(e)){-1!==n.indexOf(e)&&(n=n.replace(e,r[e].regex),s.push({token:e,...r[e]}))}n=n.replace(/[-\/\\^$*+?.()|[\]{}]/g,e=>"("===e||")"===e?e:"\\"+e);try{const t=new RegExp("^"+n+"$"),r=e.match(t);if(!r)return new h(NaN);const i=new h;i.set("hour",0).set("minute",0).set("second",0).set("millisecond",0);for(let e=0;e<s.length;e++){let t=parseInt(r[e+1]);s[e].transform&&(t=s[e].transform(r[e+1])),i.set(s[e].setter,t)}return i}catch(e){return new h(NaN)}},isValid:e=>new h(e).isValid(),min(...e){const t=e.flat().map(e=>new h(e));let r=t[0];for(let e=1;e<t.length;e++)t[e].valueOf()<r.valueOf()&&(r=t[e]);return r},max(...e){const t=e.flat().map(e=>new h(e));let r=t[0];for(let e=1;e<t.length;e++)t[e].valueOf()>r.valueOf()&&(r=t[e]);return r},tokens:{YYYY:"Full year (2025)",YY:"Short year (25)",MM:"Month 01-12",M:"Month 1-12",DD:"Day 01-31",D:"Day 1-31",HH:"Hour 00-23",H:"Hour 0-23",hh:"Hour 01-12",h:"Hour 1-12",mm:"Minute 00-59",m:"Minute 0-59",ss:"Second 00-59",s:"Second 0-59",SSS:"Milliseconds",A:"AM/PM",a:"am/pm",ddd:"Day name short (Mon)",dddd:"Day name full (Monday)",MMM:"Month name short (Jan)",MMMM:"Month name full (January)"}});const d={_prefix:"domma:",_available:null,isAvailable(){if(null!==this._available)return this._available;try{const e=`${this._prefix}__test__`;localStorage.setItem(e,"test"),localStorage.removeItem(e),this._available=!0}catch(e){this._available=!1}return this._available},_prefixKey(e){return`${this._prefix}${e}`},_unprefixKey(e){return e.slice(this._prefix.length)},get(e,t=null){if(!this.isAvailable())return t;try{const r=this._prefixKey(e),n=localStorage.getItem(r);return null===n?t:JSON.parse(n)}catch(r){return console.warn(`Domma storage: Failed to parse key "${e}"`,r),t}},set(e,t){if(!this.isAvailable())return!1;try{const r=this._prefixKey(e),n=JSON.stringify(t);return localStorage.setItem(r,n),!0}catch(t){return console.warn(`Domma storage: Failed to set key "${e}"`,t),!1}},remove(e){if(!this.isAvailable())return!1;try{const t=this._prefixKey(e);return localStorage.removeItem(t),!0}catch(t){return console.warn(`Domma storage: Failed to remove key "${e}"`,t),!1}},has(e){if(!this.isAvailable())return!1;try{const t=this._prefixKey(e);return null!==localStorage.getItem(t)}catch(e){return!1}},clear(){if(!this.isAvailable())return 0;try{const e=this.keys();return e.forEach(e=>this.remove(e)),e.length}catch(e){return console.warn("Domma storage: Failed to clear storage",e),0}},keys(){if(!this.isAvailable())return[];try{const e=[];for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);r&&r.startsWith(this._prefix)&&e.push(this._unprefixKey(r))}return e}catch(e){return[]}},size(e){if(!this.isAvailable())return 0;try{const t=this._prefixKey(e),r=localStorage.getItem(t);return r?new Blob([r]).size:0}catch(e){return 0}},totalSize(){if(!this.isAvailable())return 0;try{let e=0;return this.keys().forEach(t=>{e+=this.size(t)}),e}catch(e){return 0}},getAll(){if(!this.isAvailable())return{};const e={};return this.keys().forEach(t=>{e[t]=this.get(t)}),e},setAll(e){if(!this.isAvailable()||!e)return!1;let t=!0;return Object.keys(e).forEach(r=>{this.set(r,e[r])||(t=!1)}),t}};class p{constructor(e,t={},r={}){this._schema=e,this._data={},this._initialData={},this._bindings=new Map,this._changeCallbacks=new Set,this._fieldCallbacks=new Map,this._persistKey=r.persist||null,this._autoSave=!1!==r.autoSave;for(const r in e){const n=e[r],s=void 0!==n.default?n.default:null;this._data[r]=void 0!==t[r]?t[r]:s,this._initialData[r]=this._data[r]}this._persistKey&&this._loadFromStorage()}get(e){return e?this._data[e]:{...this._data}}set(e,t){if("object"==typeof e)for(const t in e)this._setField(t,e[t]);else this._setField(e,t);return this}_setField(t,r){const n=this._data[t];if(this._schema[t]){const e=this._validateField(t,r);if(!e.valid)throw new Error(`Validation failed for ${t}: ${e.error}`)}this._data[t]=r,e.isEqual(n,r)||(this._notifyChange(t,r,n),this._updateBindings(t,r),this._persistKey&&this._autoSave&&this._saveToStorage())}_validateField(e,t){const r=this._schema[e];if(r.required&&(null==t||""===t))return{valid:!1,error:"Required field is empty"};if(null!=t&&r.type){const e=g.types[r.type];if(e&&!e(t))return{valid:!1,error:`Expected type ${r.type}`}}if(void 0!==r.min&&"number"==typeof t&&t<r.min)return{valid:!1,error:`Value must be at least ${r.min}`};if(void 0!==r.max&&"number"==typeof t&&t>r.max)return{valid:!1,error:`Value must be at most ${r.max}`};if(void 0!==r.minLength&&"string"==typeof t&&t.length<r.minLength)return{valid:!1,error:`Length must be at least ${r.minLength}`};if(void 0!==r.maxLength&&"string"==typeof t&&t.length>r.maxLength)return{valid:!1,error:`Length must be at most ${r.maxLength}`};if(r.pattern&&"string"==typeof t&&!r.pattern.test(t))return{valid:!1,error:"Value does not match pattern"};if(r.validate&&"function"==typeof r.validate){const e=r.validate(t);if(!1===e)return{valid:!1,error:"Custom validation failed"};if("string"==typeof e)return{valid:!1,error:e}}return{valid:!0}}validate(){const e=[];for(const t in this._schema){const r=this._validateField(t,this._data[t]);r.valid||e.push({field:t,error:r.error})}return{valid:0===e.length,errors:e}}toJSON(){return{...this._data}}onChange(e){return this._changeCallbacks.add(e),()=>this._changeCallbacks.delete(e)}onFieldChange(e,t){return this._fieldCallbacks.has(e)||this._fieldCallbacks.set(e,new Set),this._fieldCallbacks.get(e).add(t),()=>this._fieldCallbacks.get(e).delete(t)}_notifyChange(e,t,r){for(const n of this._changeCallbacks)n({field:e,newValue:t,oldValue:r,model:this});if(this._fieldCallbacks.has(e))for(const n of this._fieldCallbacks.get(e))n(t,r,this)}_updateBindings(e,t){if(this._bindings.has(e))for(const r of this._bindings.get(e))r.update(t)}_addBinding(e,t){this._bindings.has(e)||this._bindings.set(e,new Set),this._bindings.get(e).add(t)}_removeBinding(e,t){this._bindings.has(e)&&this._bindings.get(e).delete(t)}reset(t=!1){for(const t in this._initialData)this.set(t,e.cloneDeep(this._initialData[t]));return t&&this._persistKey&&this.clearStorage(),this}destroy(e=!1){e&&this._persistKey&&this.clearStorage(),this._changeCallbacks.clear(),this._fieldCallbacks.clear(),this._bindings.clear()}save(){return this._saveToStorage()}load(){return this._loadFromStorage()}clearStorage(){return!!this._persistKey&&d.remove(`model:${this._persistKey}`)}getPersistKey(){return this._persistKey}isPersisted(){return null!==this._persistKey}_saveToStorage(){if(!this._persistKey)return!1;try{return d.set(`model:${this._persistKey}`,this._data)}catch(e){return console.warn("Domma Model: Failed to save to storage",e),!1}}_loadFromStorage(){if(!this._persistKey)return!1;try{const e=d.get(`model:${this._persistKey}`);if(e&&"object"==typeof e){for(const t in e)void 0!==this._schema[t]&&(this._data[t]=e[t]);return!0}return!1}catch(e){return console.warn("Domma Model: Failed to load from storage",e),!1}}}class y{constructor(e,t,r,n={}){this.model=e,this.field=t,this.element=r,this.options=n,this.format=n.format||(e=>e),this.parse=n.parse||(e=>e),this.twoWay=n.twoWay||!1,this._eventHandler=null,this.update(e.get(t)),this.twoWay&&this._setupTwoWay()}update(e){const t=this.format(e),r=this.element;"INPUT"===r.tagName||"TEXTAREA"===r.tagName?"checkbox"===r.type?r.checked=Boolean(t):"radio"===r.type?r.checked=r.value===String(t):r.value=null!=t?t:"":"SELECT"===r.tagName?r.value=t:r.textContent=null!=t?t:""}_setupTwoWay(){const e=this.element,t=this._getEventType();this._eventHandler=t=>{let r;r="checkbox"===e.type?e.checked:"number"===e.type||"range"===e.type?""===e.value?null:Number(e.value):e.value;try{this.model.set(this.field,this.parse(r))}catch(e){console.warn("Binding validation error:",e.message)}},e.addEventListener(t,this._eventHandler)}_getEventType(){const e=this.element;return"SELECT"===e.tagName||"checkbox"===e.type||"radio"===e.type?"change":"input"}destroy(){if(this._eventHandler){const e=this._getEventType();this.element.removeEventListener(e,this._eventHandler)}this.model._removeBinding(this.field,this)}}const g={_events:new Map,subscribe(e,t){return this._events.has(e)||this._events.set(e,new Set),this._events.get(e).add(t),()=>this.unsubscribe(e,t)},on(e,t){return this.subscribe(e,t)},unsubscribe(e,t){this._events.has(e)&&this._events.get(e).delete(t)},off(e,t){this.unsubscribe(e,t)},publish(e,t){if(this._events.has(e))for(const r of this._events.get(e))r(t)},emit(e,t){this.publish(e,t)},once(e,t){const r=n=>{this.unsubscribe(e,r),t(n)};return this.subscribe(e,r)},clear(e){e?this._events.delete(e):this._events.clear()},create:(e,t={},r={})=>new p(e,t,r),types:{string:e=>"string"==typeof e,number:e=>"number"==typeof e&&!Number.isNaN(e),boolean:e=>"boolean"==typeof e,array:e=>Array.isArray(e),object:e=>null!==e&&"object"==typeof e&&!Array.isArray(e),date:e=>e instanceof Date&&!isNaN(e.getTime()),any:()=>!0},bind(e,t,r,n={}){const s="string"==typeof r?document.querySelectorAll(r):[r],i=[];for(const r of s){const s=new y(e,t,r,n);e._addBinding(t,s),i.push(s)}return()=>{for(const e of i)e.destroy()}},_stores:new Map,store(e,t={}){if(!this._stores.has(e)){const r={state:{...t},listeners:new Set,getState(){return{...this.state}},setState(e){const t={...this.state};this.state={...this.state,...e};for(const e of this.listeners)e(this.state,t)},subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)},reset(e){this.state=e?{...e}:{...t};for(const e of this.listeners)e(this.state,{})}};this._stores.set(e,r)}return this._stores.get(e)},getStore(e){return this._stores.get(e)},removeStore(e){this._stores.delete(e)}},m=e=>null;m.version="0.8.0b",m.buildInfo={version:"0.8.0b",built:"16/12/2025 16:27",commit:"a362c96",preset:"no-ui"},m.utils=e,m.http=t,m.dates=f,m.models=g,m.storage=d;const b=e,v=f,_=g,w=d;m._=b,m.D=v,m.M=_,m.S=w,"undefined"!=typeof window&&(window.Domma=m,window._=b,window.D=v,window.M=_,window.S=w);export{v as D,m as Domma,_ as M,w as S,b as _,m as default};
